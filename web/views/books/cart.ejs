<div class="my-5">
    <h1 class="text-center mb-5">장바구니</h1>
    <div id="div_cart"></div>
</div>
<script id="temp_cart" type="x-handlebars-template">
    <table class="table">
        {{#each .}} <!--배열의 이름이 없으면 .-->
            <tr>
                <td><img src="{{thumbnail}}" width="30"></td>
                <td>{{title}}</td>
                <td>{{authors}}</td>
                <td>{{price}}</td>
                <td>{{publisher}}</td>
                <td><button class="btn btn-danger btn-sm" isbn="{{isbn}}">삭제</button></td>
            </tr>
        {{/each}}

    </table>
</script>

<script type="module">
    import {app} from "/javascripts/firebase.js";
    import {getDatabase,ref,onValue,remove} from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
    const db=getDatabase(app) 

    //장바구니 도서목록 
    const ref_cart=ref(db,`cart/${sessionStorage.getItem("uid")}`);
    onValue(ref_cart, result=>{
        let items=[];
        result.forEach(item=>{
          items.push(item.val());
        });
        const temp = Handlebars.compile($("#temp_cart").html());
        $("#div_cart").html(temp(items))
    });

    // 장바구니 삭제버튼을 클릭한 경우
    $("#div_cart").on("click",".btn", async function(){
        const isbn=$(this).attr("isbn");
        if(!confirm(`${isbn} 정말 삭제하시겠습니까?`)) return; //삭제 안할거면 return해서 빠져나감

        const ref_cart = ref(db, `cart/${sessionStorage.getItem("uid")}/${isbn}`);
        await remove(ref_cart);
        alert("삭제되었습니다.");
    });
</script>
